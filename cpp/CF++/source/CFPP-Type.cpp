/*******************************************************************************
 * Copyright (c) 2014, Jean-David Gadina - www.xs-labs.com / www.digidna.net
 * Distributed under the Boost Software License, Version 1.0.
 * 
 * Boost Software License - Version 1.0 - August 17th, 2003
 * 
 * Permission is hereby granted, free of charge, to any person or organization
 * obtaining a copy of the software and accompanying documentation covered by
 * this license (the "Software") to use, reproduce, display, distribute,
 * execute, and transmit the Software, and to prepare derivative works of the
 * Software, and to permit third-parties to whom the Software is furnished to
 * do so, all subject to the following:
 * 
 * The copyright notices in the Software and this entire statement, including
 * the above license grant, this restriction and the following disclaimer,
 * must be included in all copies of the Software, in whole or in part, and
 * all derivative works of the Software, unless such copies or derivative
 * works are solely in the form of machine-executable object code generated by
 * a source language processor.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE, TITLE AND NON-INFRINGEMENT. IN NO EVENT
 * SHALL THE COPYRIGHT HOLDERS OR ANYONE DISTRIBUTING THE SOFTWARE BE LIABLE
 * FOR ANY DAMAGES OR OTHER LIABILITY, WHETHER IN CONTRACT, TORT OR OTHERWISE,
 * ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER
 * DEALINGS IN THE SOFTWARE.
 ******************************************************************************/

/*!
 * @file        CFPP-Type.cpp
 * @copyright   (c) 2014 - Jean-David Gadina - www.xs-labs.com / www.digidna.net
 * @abstract    CoreFoundation++ base abstract class for CF wrappers
 */

#include <CF++.h>

namespace CF
{
    Type::~Type( void )
    {}
    
    bool Type::operator == ( const Type & value ) const
    {
        if( this->GetCFObject() == NULL )
        {
            return false;
        }
        
        if( value.GetCFObject() == NULL )
        {
            return false;
        }
        
        return ( CFEqual( this->GetCFObject(), value.GetCFObject() ) ) ? true : false;
    }
    
    bool Type::operator != ( const Type & value ) const
    {
        return !( *( this ) == value );
    }
            
    Type::operator CFTypeRef () const
    {
        return this->GetCFObject();
    }
    
    Type::operator CFBooleanRef () const
    {
        return ( this->IsBoolean() ) ? static_cast< CFBooleanRef >( this->GetCFObject() ) : NULL;
    }
    
    Type::operator CFNumberRef () const
    {
        return ( this->IsNumber() ) ? static_cast< CFNumberRef >( this->GetCFObject() ) : NULL;
    }
    
    Type::operator CFDateRef () const
    {
        return ( this->IsDate() ) ? static_cast< CFDateRef >( this->GetCFObject() ) : NULL;
    }
    
    Type::operator CFStringRef () const
    {
        return ( this->IsString() ) ? static_cast< CFStringRef >( this->GetCFObject() ) : NULL;
    }
    
    Type::operator CFMutableStringRef () const
    {
        return ( this->IsString() ) ? static_cast< CFMutableStringRef >( const_cast< void * >( this->GetCFObject() ) ) : NULL;
    }
    
    Type::operator CFURLRef () const
    {
        return ( this->IsURL() ) ? static_cast< CFURLRef >( this->GetCFObject() ) : NULL;
    }
    
    Type::operator CFDataRef () const
    {
        return ( this->IsData() ) ? static_cast< CFDataRef >( this->GetCFObject() ) : NULL;
    }
    
    Type::operator CFMutableDataRef () const
    {
        return ( this->IsData() ) ? static_cast< CFMutableDataRef >( const_cast< void * >( this->GetCFObject() ) ) : NULL;
    }
    
    Type::operator CFArrayRef () const
    {
        return ( this->IsArray() ) ? static_cast< CFArrayRef >( this->GetCFObject() ) : NULL;
    }
    
    Type::operator CFMutableArrayRef () const
    {
        return ( this->IsArray() ) ? static_cast< CFMutableArrayRef >( const_cast< void * >( this->GetCFObject() ) ) : NULL;
    }
    
    Type::operator CFDictionaryRef () const
    {
        return ( this->IsDictionary() ) ? static_cast< CFDictionaryRef >( this->GetCFObject() ) : NULL;
    }
    
    Type::operator CFMutableDictionaryRef () const
    {
        return ( this->IsDictionary() ) ? static_cast< CFMutableDictionaryRef >( const_cast< void * >( this->GetCFObject() ) ) : NULL;
    }
    
    Type::operator CFUUIDRef () const
    {
        return ( this->IsUUID() ) ? static_cast< CFUUIDRef >( this->GetCFObject() ) : NULL;
    }
    
    Type::operator CFErrorRef () const
    {
        return ( this->IsError() ) ? static_cast< CFErrorRef >( const_cast< void * >( this->GetCFObject() ) ) : NULL;
    }
    
    Type::operator CFReadStreamRef () const
    {
        return ( this->IsReadStream() ) ? static_cast< CFReadStreamRef >( const_cast< void * >( this->GetCFObject() ) ) : NULL;
    }
    
    Type::operator CFWriteStreamRef () const
    {
        return ( this->IsWriteStream() ) ? static_cast< CFWriteStreamRef >( const_cast< void * >( this->GetCFObject() ) ) : NULL;
    }
    
    std::string Type::Description( void ) const
    {
        CFStringRef  cfDescription;
        std::string  description;
        char       * cStr;
        size_t       length;
        
        if( this->GetCFObject() == NULL )
        {
            return "(null)";
        }
        
        cfDescription = CFCopyDescription( this->GetCFObject() );
        
        if( cfDescription == NULL )
        {
            return "(null)";
        }
        
        length = static_cast< size_t >( CFStringGetMaximumSizeForEncoding( CFStringGetLength( cfDescription ), CFStringGetSystemEncoding() ) );
        
        cStr = static_cast< char * >( calloc( length + 1, 1 ) );
        
        if( cStr == NULL )
        {
            CFRelease( cfDescription );
            
            return "(null)";
        }
        
        CFStringGetCString( cfDescription, cStr, static_cast< CFIndex >( length + 1 ), CFStringGetSystemEncoding() );
        
        description = std::string( cStr );
        
        free( cStr );
        CFRelease( cfDescription );
        
        return description;
    }
    
    CFHashCode Type::Hash( void ) const
    {
        if( this->GetCFObject() == NULL )
        {
            return static_cast< CFHashCode >( 0 );
        }
        
        return CFHash( this->GetCFObject() );
    }
    
    CFIndex Type::GetRetainCount( void ) const
    {
        if( this->GetCFObject() == NULL )
        {
            return 0;
        }
        
        return CFGetRetainCount( this->GetCFObject() );
    }
    
    bool Type::IsValid( void ) const
    {
        return ( this->GetCFObject() != NULL ) ? true : false;
    }
    
    bool Type::IsBoolean( void ) const
    {
        return this->GetTypeID() == CFBooleanGetTypeID();
    }
    
    bool Type::IsNumber( void ) const
    {
        return this->GetTypeID() == CFNumberGetTypeID();
    }
    
    bool Type::IsDate( void ) const
    {
        return this->GetTypeID() == CFDateGetTypeID();
    }
    
    bool Type::IsString( void ) const
    {
        return this->GetTypeID() == CFStringGetTypeID();
    }
    
    bool Type::IsURL( void ) const
    {
        return this->GetTypeID() == CFURLGetTypeID();
    }
    
    bool Type::IsData( void ) const
    {
        return this->GetTypeID() == CFDataGetTypeID();
    }
    
    bool Type::IsArray( void ) const
    {
        return this->GetTypeID() == CFArrayGetTypeID();
    }
    
    bool Type::IsDictionary( void ) const
    {
        return this->GetTypeID() == CFDictionaryGetTypeID();
    }
    
    bool Type::IsUUID( void ) const
    {
        return this->GetTypeID() == CFUUIDGetTypeID();
    }
    
    bool Type::IsError( void ) const
    {
        return this->GetTypeID() == CFErrorGetTypeID();
    }
    
    bool Type::IsReadStream( void ) const
    {
        return this->GetTypeID() == CFReadStreamGetTypeID();
    }
    
    bool Type::IsWriteStream( void ) const
    {
        return this->GetTypeID() == CFWriteStreamGetTypeID();
    }
    
    void Type::Show( void ) const
    {
        std::string className;
        
        className = "CF::Type";
        
        if( this->IsBoolean() )
        {
            className = "CF::Boolean";
        }
        else if( this->IsNumber() )
        {
            className = "CF::Number";
        }
        else if( this->IsDate() )
        {
            className = "CF::Date";
        }
        else if( this->IsString() )
        {
            className = "CF::String";
        }
        else if( this->IsURL() )
        {
            className = "CF::URL";
        }
        else if( this->IsURL() )
        {
            className = "CF::Data";
        }
        else if( this->IsArray() )
        {
            className = "CF::Array";
        }
        else if( this->IsDictionary() )
        {
            className = "CF::Dictionary";
        }
        
        std::cout << className << " - " << this->Description() << std::endl;
    }
    
    std::ostream & operator << ( std::ostream & os, const Type & obj )
    {
        os << obj.Description();
        
        return os;
    }
}
